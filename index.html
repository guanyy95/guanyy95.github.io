<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>蹲在天边拉屎</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="蹲在天边拉屎">
<meta property="og:url" content="https://guanyy95.github.io/index.html">
<meta property="og:site_name" content="蹲在天边拉屎">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="GYY">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="蹲在天边拉屎" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">蹲在天边拉屎</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://guanyy95.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Unity优化篇-Texture纹理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/28/Unity%E4%BC%98%E5%8C%96%E7%AF%87-Texture%E7%BA%B9%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2025-02-28T02:55:05.000Z" itemprop="datePublished">2025-02-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/28/Unity%E4%BC%98%E5%8C%96%E7%AF%87-Texture%E7%BA%B9%E7%90%86/">Unity优化篇-Texture纹理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Texture纹理"><a href="#Texture纹理" class="headerlink" title="Texture纹理"></a>Texture纹理</h2><h3 id="导入设置"><a href="#导入设置" class="headerlink" title="导入设置"></a>导入设置</h3><ol>
<li>Alpha Source选择Input Texture Alpha</li>
<li>Alpha Is Transparency: 默认不勾选</li>
<li>Igonre Png file gamma: 默认不勾选</li>
</ol>
<p>Advanced:</p>
<ol>
<li>Read&#x2F;Write: 默认不开启</li>
<li>Mipmap: 2D或摄像机固定视角远近没有改变，不开启。</li>
</ol>
<p>CheckList:</p>
<ol>
<li>纹理资源大小长宽均为2的幂次</li>
<li>纹理过大的问题，纹理尺寸大于1024 * 1024</li>
<li>纹理图集利用率偏低</li>
<li>同一图集中的纹理生命周期不同，导致纹理资源长期贮存内存</li>
<li>过大不合理的半透明我呢里，增加了Overdraw</li>
<li>大量的2D序列帧动画</li>
<li>大量重复纹理与不合理的通道图</li>
<li>可以使用九宫格的进行切图操作，减小资源占用大小</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2025/02/28/Unity%E4%BC%98%E5%8C%96%E7%AF%87-Texture%E7%BA%B9%E7%90%86/" data-id="cm7o74kkd000mesw45705hjiy" data-title="Unity优化篇-Texture纹理" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/10/23/hello-world/" class="article-date">
  <time class="dt-published" datetime="2024-10-23T07:13:51.697Z" itemprop="datePublished">2024-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Testing/">Testing</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/10/23/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2024/10/23/hello-world/" data-id="cm7o74kkd000pesw45irp8kox" data-title="Hello World" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-【游戏开发】UGUI合批问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/22/%E3%80%90%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E3%80%91UGUI%E5%90%88%E6%89%B9%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2023-07-22T04:25:20.000Z" itemprop="datePublished">2023-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/22/%E3%80%90%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E3%80%91UGUI%E5%90%88%E6%89%B9%E9%97%AE%E9%A2%98/">【游戏开发】UGUI合批问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近正在面试的过程中，会发现面试中问到的关注点在平时工作中过于负责上层的业务了没有关注到。这次面试过程进行的时候也同时学习和做个记录</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq826364410/article/details/80983861"># UGUI合批源码分析及优化</a></p>
<h2 id="UGUI渲染的规则"><a href="#UGUI渲染的规则" class="headerlink" title="UGUI渲染的规则"></a>UGUI渲染的规则</h2><p>UGUI中所有的绘制都会传递给Canvans，合批是以canvas为单位进行批次生成和渲染，Canvas可以嵌套包含canvas。</p>
<h3 id="Batching流程"><a href="#Batching流程" class="headerlink" title="Batching流程"></a>Batching流程</h3><ol>
<li>查看canvas alpha是否为0，是否隐藏，隐藏时不产生合批</li>
<li>UI层次结构发生变化，更新Batch的顺序，对UI元素的覆盖了几个元素为依据生成当前的depth，不渲染的元素初始化为-1，后面没有覆盖元素的话为0，有则+1</li>
<li>然后对所有VisiableList里面canvas节点下的元素进行排序（深度、materialInstanceID材质、textureInstanceID贴图），</li>
<li>决定合批：按照VisiableList排序后的元素逐个进行合批判断，此时只看相邻的元素材质和贴图是否相同，相同则可合批</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/303c3925a15a45efa57dd2b2ff0bd23d~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78c9b708d5254a8a87692bfb6815ddac~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>注意：在Depth计算算法中，由于要遍历所有UI元素和已计算的底层UI元素（平方复杂度），源码中使用分组计算包围盒矩形的方法加快计算，即16个UI元素为一组计算Group Rect，检查是否与底层UI元素相交时，先计算是否与底层Group相交，如果相交再与Group中的元素做判定。</p>
<p>因此，UI元素数目过多和层次结构过于复杂，会影响排序和Batch更新速度，合理规划UI元素数量和层次结构可以提高UI性能。</p>
<p><strong>小结：</strong></p>
<p>从UGUI批次合并生成规则可以看出，提高UI性能尽量注意以下几点：</p>
<ul>
<li>尽量避免使用Mask，使用Mask至少增加两个Drawcall，并可能导致本可以Batch的UI元素无法Batch，从而增加更多Drawcall。</li>
<li>避免在UI树形结构下（Canvas下）频繁删除&#x2F;增加UI对象，UI层次结构发生变化会引起整个Canvas UI顺序更新，特别是复杂的UI树形结构。</li>
<li>避免频繁动态的更新UI元素的Vertex, Rect, Color, Material, Texture等，可能引起Canvas数据更新和Batch更新计算，有可能引起VBO Update（重新提交顶点数据）。</li>
<li>尽可能使用少的UI Material和贴图（使用图集），使得可以Batching。</li>
<li>相邻的UI元素（比如父节点与第一个子节点、相同层次结构下的节点），使用相同材质贴图的UI元素尽可能排在一起，便于合并。</li>
<li>同一父节点下所有子节点，保持相同的层次结构（如List控件下的item），便于底层相同depth下UI元素Batch。</li>
<li>避免UI元素数目过多和层次结构过于复杂影响Batch更新速度。</li>
<li>固定的Text考虑与背景图层合在一张图上（可能不便本地化，但可以减少drawcall）。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2023/07/22/%E3%80%90%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E3%80%91UGUI%E5%90%88%E6%89%B9%E9%97%AE%E9%A2%98/" data-id="cm7o74kkf000yesw4heuqgxmr" data-title="【游戏开发】UGUI合批问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-根据模板生成pdf合同脚本使用说明" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/25/%E6%A0%B9%E6%8D%AE%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90pdf%E5%90%88%E5%90%8C%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/" class="article-date">
  <time class="dt-published" datetime="2023-01-25T04:33:49.000Z" itemprop="datePublished">2023-01-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/25/%E6%A0%B9%E6%8D%AE%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90pdf%E5%90%88%E5%90%8C%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">根据模板生成pdf合同脚本使用说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="0-0-背景"><a href="#0-0-背景" class="headerlink" title="0.0 背景"></a>0.0 背景</h2><p>最近朋友有两个工作上小的需求，需要找外包开发个程序，想要一个桌面应用。他的需求是用模板根据不同用户的信息生成不同的合同，另一个本质就是一个计算器需求，根据几个变量参数计算税金的结果。</p>
<h2 id="1-0-实现方法"><a href="#1-0-实现方法" class="headerlink" title="1.0 实现方法"></a>1.0 实现方法</h2><p>第二个计算器没有什么特殊的，第一个根据网上现有的一些库看了看不同的实现方法，决定用一个比较简单去操作且性价比很高的方法。首先语言可以有多种选择，并且每种实现都会有对应的库来搞定这个需求。</p>
<ol>
<li>JS + Electron，使用DocxTemplater(模板生成doc)、libre office(转化成pdf)</li>
<li>python + QT5，使用python-docx(模板生成doc)、docx2pdf、openpyxl</li>
</ol>
<p>这次使用了第二种方法来实现，因为电脑没有配置electron一套的开发环境，就直接用python来实现了。这个方法的缺点就是有些局限，没法多端同步需要重写开发。QT的使用我觉得用处不大，目前仅仅是一个启动和一个生成文件名的显示，其实不用也可以，先留着给计算器需要的时候用吧。</p>
<h2 id="2-0-使用方法"><a href="#2-0-使用方法" class="headerlink" title="2.0 使用方法"></a>2.0 使用方法</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9027476954741e9ae101bc2fad3ae69~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<ul>
<li>main.exe 脚本程序</li>
<li>1.docx 模板(支持多模板生成)</li>
<li>data 数据生成表格(名称不能更改)</li>
</ul>
<p>将main.exe文件放在项目工程的一级目录下,运行后点击生成即可。同级目录下的DocResults和PdfResults分别存放生成后的输出文件，没有此文件夹会先自动创建一个。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac77780d65304e988eb490fca8b739ca~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h3 id="2-1-data数据结构"><a href="#2-1-data数据结构" class="headerlink" title="2.1 data数据结构"></a>2.1 data数据结构</h3><p>1.docx<br><img src="" alt="" width="50%" /><br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65cb6f2814e843e6bcfe873ee2768687~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>data.xlsx</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74d6f586fcf14fd6952df2d63b20a070~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>data表中表头字段除了#模板号外需要与替换模板中一对一匹配，第一列为使用的模板参数，如需支持多个模板即创建同名模板放置在1级目录即可。只需维护好模板和data的对应即可，每一次生生成都会全量更新即每次更新都为最新结果。</p>
<h2 id="后续优化"><a href="#后续优化" class="headerlink" title="后续优化"></a>后续优化</h2><ol>
<li>不确定数量很多时会不会有问题，使用多线程进行生成操作</li>
<li>对源码进行一个整理重构，使用QT信号更新UI。</li>
<li>后续会将脚本上传Github</li>
<li>第一种实现方案也放上参考链接 <a target="_blank" rel="noopener" href="https://juejin.cn/post/7092775366317572104">https://juejin.cn/post/7092775366317572104</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2023/01/25/%E6%A0%B9%E6%8D%AE%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90pdf%E5%90%88%E5%90%8C%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/" data-id="cm7o74kki001eesw42e1xhxxt" data-title="根据模板生成pdf合同脚本使用说明" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Lua奇淫小技巧" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/12/10/Lua%E5%A5%87%E6%B7%AB%E5%B0%8F%E6%8A%80%E5%B7%A7/" class="article-date">
  <time class="dt-published" datetime="2022-12-10T11:16:31.000Z" itemprop="datePublished">2022-12-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/12/10/Lua%E5%A5%87%E6%B7%AB%E5%B0%8F%E6%8A%80%E5%B7%A7/">Lua奇淫小技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>工作中的项目主要是使用Unity + Lua的开发模式，日常需求基本使用lua开发各类模块。相比于传统的C# C++等常见语言，Lua有一些特别的小点会需要区分一下</p>
<h3 id="Logical-Operators-逻辑运算处理"><a href="#Logical-Operators-逻辑运算处理" class="headerlink" title="Logical Operators 逻辑运算处理"></a><a target="_blank" rel="noopener" href="http://www.lua.org/manual/5.4/manual.html#3.4.5">Logical Operators 逻辑运算处理</a></h3><p>运算符有三种 and、or 和 not。所有的逻辑运算符值把false和nil都当做false进行处理，其余值都为true。</p>
<ol>
<li>not ： negation总是返回false 或者 true</li>
<li>and : conjunction 如果第一个参数是false或者nil，就返回第一个参数，否则返回第二个参数</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">nil</span> <span class="keyword">and</span> <span class="number">10</span>          <span class="comment">--&gt; nil</span></span><br><span class="line"><span class="literal">false</span> <span class="keyword">and</span> <span class="built_in">error</span>()   <span class="comment">--&gt; false</span></span><br><span class="line"><span class="literal">false</span> <span class="keyword">and</span> <span class="literal">nil</span>       <span class="comment">--&gt; false</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">and</span> <span class="number">20</span>           <span class="comment">--&gt; 20</span></span><br><span class="line"><span class="literal">nil</span> == <span class="literal">nil</span> <span class="keyword">and</span> <span class="number">10</span>   <span class="comment">--&gt; 10</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>or : disjunction 如果第一个参数不是false或者nil，则返回第一个参数，否则返回第二个参数<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span> <span class="keyword">or</span> <span class="number">20</span>            <span class="comment">--&gt; 10</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">or</span> <span class="built_in">error</span>()       <span class="comment">--&gt; 10</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">or</span> <span class="number">20</span>            <span class="comment">--&gt; 10</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">or</span> <span class="built_in">error</span>()       <span class="comment">--&gt; 10</span></span><br><span class="line"><span class="literal">false</span> <span class="keyword">or</span> <span class="literal">nil</span>        <span class="comment">--&gt; nil</span></span><br></pre></td></tr></table></figure></li>
<li>开发中通常会使用两种方式使用，一个是类似三元运算符的用法，一个是设置默认值得方法<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 默认值设置</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">(val)</span></span></span><br><span class="line"><span class="keyword">local</span> a  = val <span class="keyword">or</span> defaultVal</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 三元判断</span></span><br><span class="line"><span class="keyword">local</span> bool = a <span class="keyword">and</span> b <span class="keyword">or</span> c</span><br><span class="line"><span class="comment">-- 此处有个常见的易错带你</span></span><br><span class="line">业务中常用<span class="keyword">if</span>进行判断一个对象是空<span class="literal">nil</span>还是有值<span class="keyword">if</span> <span class="built_in">table</span>[i] <span class="keyword">then</span></span><br><span class="line">此时如果用同样的方法会得到错误的结果</span><br><span class="line">a 如果为空 则直接返回<span class="literal">nil</span>而不是输出结果c，如果使用判断则需要注意将a需要是个boolean</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> bool = a == <span class="literal">nil</span> <span class="keyword">and</span> b <span class="keyword">or</span> c</span><br><span class="line"><span class="literal">true</span> <span class="keyword">and</span> b -&gt; b, 返回 b <span class="keyword">or</span> c</span><br><span class="line"><span class="literal">false</span> <span class="keyword">and</span> b -&gt; <span class="literal">false</span>, 返回<span class="literal">false</span> <span class="keyword">or</span> c</span><br><span class="line">如果a是空，则返回b 否则返回c</span><br></pre></td></tr></table></figure></li>
<li><a target="_blank" rel="noopener" href="http://www.lua.org/manual/5.4/manual.html#3.4.8">运算符的优先度 </a></li>
</ol>
<p>当多个逻辑判断条件混用的时候，lua中需要注意一下顺序，not &gt; ~ &gt; and &gt; or </p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="keyword">and</span></span><br><span class="line">&lt;     &gt;     &lt;=    &gt;=    ~=    ==</span><br><span class="line">|</span><br><span class="line">~</span><br><span class="line">&amp;</span><br><span class="line">&lt;&lt;    &gt;&gt;</span><br><span class="line">..</span><br><span class="line">+     -</span><br><span class="line">*     /     //    %</span><br><span class="line">unary operators (<span class="keyword">not</span>   #     -     ~)</span><br><span class="line">^</span><br></pre></td></tr></table></figure>
<h3 id="The-Length-Operator-长度运算符"><a href="#The-Length-Operator-长度运算符" class="headerlink" title="The Length Operator #长度运算符"></a><a target="_blank" rel="noopener" href="http://www.lua.org/manual/5.4/manual.html#3.4.7">The Length Operator #长度运算符</a></h3><p>能够做为长度索引的条件在Lua中是这样定义border的，当是个连续的sequence会return only border。当#对象不是一个sequence，结果是不定的。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(border == <span class="number">0</span> <span class="keyword">or</span> t[border] ~= <span class="literal">nil</span>) <span class="keyword">and</span></span><br><span class="line">(t[border + <span class="number">1</span>] == <span class="literal">nil</span> <span class="keyword">or</span> border == <span class="built_in">math</span>.maxinteger)</span><br></pre></td></tr></table></figure>
<p>不适用默认的#运算规则，也可以自己重写__len metamethods</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2022/12/10/Lua%E5%A5%87%E6%B7%AB%E5%B0%8F%E6%8A%80%E5%B7%A7/" data-id="cm7o74kkb000hesw43jmm6y7j" data-title="Lua奇淫小技巧" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Lua热加载实现方案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/06/05/Lua%E7%83%AD%E5%8A%A0%E8%BD%BD%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2022-06-05T12:07:24.000Z" itemprop="datePublished">2022-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/06/05/Lua%E7%83%AD%E5%8A%A0%E8%BD%BD%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/">Lua热加载实现方案</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>游戏开发的日常开发中，每当进行了View层或者逻辑代码的修改之后都需要重新启动引擎，如果修改的代码是C#则需要重新编译，如果是Lua、Python等脚本语言则需要重新执行启动main入口进行脚本的加载。常见的Lua热更新都是在客户端下载所有Lua代码之后重启游戏，实现重载所有数据和函数的目的。</p>
<p>除了热更新之外，还可以实现运行时热更。在玩家运行有的时候进行无感知的代码加载。Lua中可以使用require对文件进行加载以实现更新。简单的require会将数据层的模块修改，旧的数据或者缓存会被重置。</p>
<p>要实现比较合理的运行时热更新，除了设计热更的逻辑之外，前提是遵循一些约定。在规定热更新约定之前，先了解一下Lua热更新涉及的原理。</p>
<h2 id="常见的热更新方案"><a href="#常见的热更新方案" class="headerlink" title="常见的热更新方案"></a>常见的热更新方案</h2><p>本人公司的项目中使用了Lua进行逻辑层面的开发，项目中也支持Unity编辑器下的热重载功能，我对这个功能进行了一个简单的了解。Lua脚本语言可以依靠虚拟机的动态加载实现重载，C# 代码需要进行编译后执行。</p>
<h3 id="Lua热重载大致思路"><a href="#Lua热重载大致思路" class="headerlink" title="Lua热重载大致思路"></a>Lua热重载大致思路</h3><p>编辑器下热重载的主要思路就是监听某个文件夹下的所有文件的变化，当有变化发生的时候重新require。这里面需要保持的原则就是更新替换新的function但是保持原有lua模块中的所有值，使用debug库获取upvalue进行数据的迁移，最后再替换旧的table并刷新_G表。</p>
<h3 id="1-实现监听文件变化"><a href="#1-实现监听文件变化" class="headerlink" title="1. 实现监听文件变化"></a>1. 实现监听文件变化</h3><ul>
<li>Unity API: AssetPostprocessor</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">List&lt;<span class="built_in">string</span>&gt; hotLoadFiles = <span class="keyword">new</span> List&lt;stirng&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">MyAllPostprocessor</span> : <span class="title">AssetPostprocessor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnPostprocessAllAssets</span>(<span class="params"><span class="built_in">string</span>[] importedAssets, <span class="built_in">string</span>[] deletedAssets, <span class="built_in">string</span>[] movedAssets, <span class="built_in">string</span>[] movedFromAssetPaths</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">string</span> str <span class="keyword">in</span> importedAssets)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// str是文件的全路径，Reimported Asset: Assets/Lua/Test 1.lua</span></span><br><span class="line">            <span class="comment">// 匹配出Test1部分然后使用requre去加载</span></span><br><span class="line">            <span class="keyword">if</span> (!str.EndsWith(<span class="string">&quot;.lua&quot;</span>) || str.Contains(<span class="string">&quot;Main.lua&quot;</span>))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">           </span><br><span class="line">            hotLoadFiles.Add(str);</span><br><span class="line">            -- 首先执行一遍热更新的逻辑控制代码</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; hotLoadFiles.Count; i++) &#123;</span><br><span class="line">                 -- Todo 系统模块代码进行读值重载操作</span><br><span class="line">                 LuaHotModule.Reload(hotLoadFiles[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Debug.Log(<span class="string">&quot;Reimported Asset: &quot;</span> + str);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">string</span> str <span class="keyword">in</span> deletedAssets)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Deleted Asset: &quot;</span> + str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; movedAssets.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Moved Asset: &quot;</span> + movedAssets[i] + <span class="string">&quot; from: &quot;</span> + movedFromAssetPaths[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用Unity编辑器下的FileSystemWatcher</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Directory.Exists(dirPath)) </span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">var</span> watcher = <span class="keyword">new</span> FileSystemWatcher();</span><br><span class="line">watcher.IncludeSubdirectories = <span class="literal">true</span>;</span><br><span class="line">watcher.Path = dirPath;</span><br><span class="line">watcher.NotifyFilter = NotifyFilters.LastWrite;</span><br><span class="line">watcher.Filter = <span class="string">&quot;*.lua&quot;</span>;</span><br><span class="line">watcher.Changed += handler;</span><br><span class="line">watcher.EnableRaisingEvents = <span class="literal">true</span>;</span><br><span class="line">watcher.InternalBufferSize = <span class="number">10240</span>;</span><br></pre></td></tr></table></figure>
<h3 id="2-实现Lua文件的热重载"><a href="#2-实现Lua文件的热重载" class="headerlink" title="2. 实现Lua文件的热重载"></a>2. 实现Lua文件的热重载</h3><h4 id="require机制"><a href="#require机制" class="headerlink" title="require机制"></a>require机制</h4><p>Lua中对模块的管理可以使用Require函数来实现，把公用的代码放在一个目录下，然后用API接口进行调用。实现代码的解耦和重用。</p>
<p>Lua中的module是由变量、函数、和数据table组成。一个模块就是Lua中的一个table就可以作为一个模块，只要在lua文件中将其return就可以供外部进行使用，其使用方法和Javascript的模块管理使用方法类似。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- test.lua</span></span><br><span class="line"><span class="keyword">local</span> test = Class()</span><br><span class="line"></span><br><span class="line">test.name = <span class="string">&quot;test&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test:OnCreated</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test:OnUpdated</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> test</span><br><span class="line"></span><br><span class="line"><span class="comment">-- main.lua</span></span><br><span class="line"><span class="keyword">local</span> testCls = <span class="built_in">require</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">或</span><br><span class="line"><span class="keyword">local</span> testCls = <span class="built_in">require</span> <span class="string">&quot;test&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>require之后，Lua本身会在package.loaded的table中缓存一份test.lua的模块数据，并且多次require只会执行一次，当loaded中有就返回package.loaded[“test”]。实现模块的更新就是清空原有的模块数据，并且执行加载新的模块，如果只进行这种处理的化会发先，是模块中的缓存数据也会被清空，很多数据都只会在登录的时候进行赋值。所以实现热重载就需要更新模块的function，但是不更新模块中的upvalue。热重载不希望数据被覆盖或清空。使用Lua提供的API debug.getupvalue和debug.setupvalue可以对指定table进行数据的缓存和更新。函数在Lua中也会被当做upvalue,所以对对象需要判断是不是function类型。对于函数使用新的，对于数据使用旧的，对于table类型需要递归处理。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> oldModule = <span class="built_in">require</span> <span class="string">&quot;test&quot;</span></span><br><span class="line"><span class="built_in">package</span>.<span class="built_in">loaded</span>[<span class="string">&quot;test&quot;</span>] = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">local</span> newModule = <span class="built_in">require</span> <span class="string">&quot;test&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">math</span>.<span class="built_in">huge</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> name, value = <span class="built_in">debug</span>.<span class="built_in">getupvalue</span>(oldModule, i)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">debug</span>.<span class="built_in">setupvalue</span>(newModule, i, value)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="热更新规则"><a href="#热更新规则" class="headerlink" title="热更新规则"></a>热更新规则</h3><ol>
<li>遍历模块的所有数据，对象是table就保留旧模块的，对象是function就保存新得</li>
<li>function本身使用新的，function对象中的upvalue使用旧的</li>
<li>使用debug.getmetatable获取table中的metatable进行更新和覆盖</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2022/06/05/Lua%E7%83%AD%E5%8A%A0%E8%BD%BD%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/" data-id="cm7o74kkc000lesw4fibtfs6x" data-title="Lua热加载实现方案" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-游戏开发中的国际化时区问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/03/19/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96%E6%97%B6%E5%8C%BA%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2022-03-19T07:10:03.000Z" itemprop="datePublished">2022-03-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/03/19/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96%E6%97%B6%E5%8C%BA%E9%97%AE%E9%A2%98/">游戏开发中的国际化时区问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在游戏开发客户端项目中，会面临很多本地化相关的问题，这其中就包含关于时区时间的问题。我们项目中做了很多关于时间相关本地化的封装，包括对时间戳的格式化显示、提供给策划使用的统一设置时间表相关。近日我开发中需要单独对一个活动预告进行单独处理，需要单独处理国际化时区的问题。自己也就对这块相关概念的处理方法进行了一个学习。</p>
<p>服务器所在地时区通常会和玩家所在地时区有误差，运营活动又要求是同步进行，所以就要通过计算进行正确的时间显示，而不是直接调用操作系统的时间接口。</p>
<h2 id="时区相关概念"><a href="#时区相关概念" class="headerlink" title="时区相关概念"></a>时区相关概念</h2><ul>
<li><p><strong>时区(TimeZone)</strong>:是地球上的区域使用同一个时间定义。国际上通过设立一个区域的标准时间部分解决了经纬度不同多带来的时间上的感官差异。世界各国位于地球额不同位置，不同国家日出日落都有所偏差，这个偏差就是时差。</p>
</li>
<li><p><strong>GMT（格林威治平均时间，Greenwich Mean Time</strong>）是指位于英国伦敦郊区的皇家格林尼治天文台当地的平太阳时，它规定太阳每天经过位于英国伦敦郊区的皇家格林威治天文台的时间为中午12点。由于地球每天的自转是有些不规则的，而且正在缓慢减速，因此格林尼治平时基于天文观测本身的缺陷，已经被原子钟报时的协调世界时（UTC）所取代。</p>
</li>
<li><p><strong>UTC</strong>（协调世界时，取自英文和法文的缩写，英文是Coordinated Universal Time）是最主要的世界时间标准，其以原子时秒长为基础，在时刻上尽量接近于格林威治标准时间</p>
</li>
<li><p><strong>本地时间</strong>是指在日常生活中所使用的时间。这个时间等于我们所在（或者所使用）时区内的当地时间，它由与世界标准时间（UTC或GMT）之间的偏移量来定义。</p>
</li>
<li><p><strong>GMT+08:00</strong>（UTC+8）即北京时间，比协调世界时快八小时。注意北京时间并不是北京的地方时间。</p>
</li>
<li><p><strong>unix时间戳</strong>是从UTC1970年1月1日0时0分0秒（UTC&#x2F;GMT的午夜）起至现在的总秒数，不考虑闰秒。因此时间戳不会因为时区的不同而不同</p>
</li>
<li><p><strong>夏令时</strong>（Daylight Saving Time：DST），又称日光节约时间，是为了节约能源，人为规定的时间。一般在天亮早的夏季人为将时间调快一小时，可以使人早起早睡，减少照明量，以充分利用光照资源，从而节约照明用电。</p>
</li>
<li><p><strong>时间戳</strong> :在开发中后端通常会发时间戳，时间戳是部分(TimeStamp)是不进行时区的区分。只要是时间戳相同就代表是同一空间上的时间节点，时差只是认为的判断区别。当进行转换日期显示的时候，才需要考虑时区的问题。</p>
</li>
</ul>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>要做到时间显示一致。有两种思路，一个是都换算成本地时间进行衡量，另一个是都以服务器角度去衡量。<br>因为当调用os.time()的时候是包括了时区的差异了。只要补上os.time()接口所产生的时间偏移量就可以了。</p>
<ol>
<li><p>首先获取服务器所在地的时区，通过登录服务器时将时区下发给客户端进行时差的矫正。</p>
<blockquote>
<p>例如：当前服务器所在地东8区UTC+8，在登录的时候就会将TimeZone下发给客户端</p>
</blockquote>
</li>
<li><p>客户端所在地然后计算与服务器时间差</p>
<blockquote>
<p>本地时区：在lua中使用os.date(“!*t”, os.time()) 获取格林尼治时间table，同通过本地解析table获取时间戳。通过与os.time()相减获取TimeZoneDiff</p>
</blockquote>
</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">TimeUtil.LocalServerTimeDiff</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> now = <span class="built_in">os</span>.<span class="built_in">time</span>()</span><br><span class="line">    <span class="comment">-- os.difftime(t1, t2) 会返回 t1 - t2</span></span><br><span class="line">    <span class="comment">-- 通过跟格林位置时间作差获取本地时区</span></span><br><span class="line">    <span class="keyword">local</span> localTimeZone = <span class="built_in">os</span>.<span class="built_in">difftime</span>(now, <span class="built_in">os</span>.<span class="built_in">time</span>(<span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&quot;!*t&quot;</span>, now)))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 其中会有一个特例，就是夏令时问题。在美国3月左右开始会进入夏令时直到10月份左右会结束进入冬令时。</span></span><br><span class="line">    <span class="comment">-- 夏令时会比冬令时快1个小时， os.date()中有一个isdst = true时代表是夏令时</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">local</span> isdst = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&quot;*t&quot;</span>, now).isdst</span><br><span class="line">    <span class="keyword">if</span> isdst <span class="keyword">then</span> </span><br><span class="line">        localTimeZone = localTimeZone + <span class="number">3600</span> </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">--  拿到两个分别的时区，进行相减就能得出当地时区与服务器的时间差。</span></span><br><span class="line">    <span class="comment">-- 每次显示时间或者计算时间的时候加上这个偏移就能得出本地相对服务器的时间。</span></span><br><span class="line">    <span class="comment">-- 3600 是一个时区差的秒数</span></span><br><span class="line">    <span class="keyword">local</span> localServerTimeZoneDiff = ServerTimeZone * <span class="number">3600</span> - localTimeZone</span><br><span class="line">    <span class="keyword">return</span> localServerTimeZoneDiff</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>当需要使用的时候，比如说定下的晚上UTC+8晚上8点开发，服务器下发的时间戳。客户端只要使用当前时间的时间戳 + localServerTimeZoneDiff就能得到相对于服务器下的本地时间。然后进行比较和计算。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是关于时间国际化的问题，总结来说时间戳是固定的，当遇到需要进行显示和调用os.date或者os.time的时候就会涉及到时区的问题，这两个方法会涉及到操作系统层面的本地转化问题。如果只用时间戳进行计算，其实是不需要额外处理时区问题的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2022/03/19/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96%E6%97%B6%E5%8C%BA%E9%97%AE%E9%A2%98/" data-id="cm7o74kki001hesw4a4tb6zvz" data-title="游戏开发中的国际化时区问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-帧同步、状态同步、状态帧同步" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/03/19/%E5%B8%A7%E5%90%8C%E6%AD%A5%E3%80%81%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E7%8A%B6%E6%80%81%E5%B8%A7%E5%90%8C%E6%AD%A5/" class="article-date">
  <time class="dt-published" datetime="2022-03-19T07:08:11.000Z" itemprop="datePublished">2022-03-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/03/19/%E5%B8%A7%E5%90%8C%E6%AD%A5%E3%80%81%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E7%8A%B6%E6%80%81%E5%B8%A7%E5%90%8C%E6%AD%A5/">帧同步、状态同步、状态帧同步</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="同步策略"><a href="#同步策略" class="headerlink" title="同步策略"></a>同步策略</h2><h2 id="帧同步"><a href="#帧同步" class="headerlink" title="帧同步"></a>帧同步</h2><ul>
<li><strong>定点数（操作系统级）</strong>：小数点位置不变，通常为纯整数或纯小数</li>
<li><strong>浮点数（操作系统级别）</strong>：额外使用尾数和阶码表示的一种小数点位置可变的数据</li>
<li><strong>IEEE754</strong>: 1985年intel 8087芯片使用的通用的浮点数表示标准</li>
</ul>
<p>浮点数有IEEE 754标准实现，但各种编程语言、编译器。CPU指令集在浮点运算取舍实现上各不相同。<br>帧同步服务器支付作为转发玩家操作指令，为了保证客户端表现的一致性，就需要定点数来实现进而消除精度上的损失，最终导致很巨大偏差的产生。</p>
<ul>
<li><strong>定点数（应用级）</strong>：使用确定精度的整形，长整形实现浮点精度的一种数据结构，因为是应用级的实现，在任意编程语言、编译器和CPU指令集上的计算结果都保持一致。</li>
</ul>
<p>简单来说，就是在电脑硬件计算上对数据的存储方式有着不同规范的区别，所以在Application层面里将底层硬件上对数据存储的方式进行一个重新计算进行更广泛的适配。人为通过整数来模拟定点数的实现来的到相同的运算结果。</p>
<h2 id="状态同步"><a href="#状态同步" class="headerlink" title="状态同步"></a>状态同步</h2><p>定义 ：只有当<strong>数据状态发生变化</strong>的时候才进行同步，将数据的变化量发送给客户端。状态同步没有逻辑帧的概念，底层有Tick帧计数器，但并不存在帧号的概念。</p>
<h2 id="状态帧同步"><a href="#状态帧同步" class="headerlink" title="状态帧同步"></a>状态帧同步</h2><p>定义：按<strong>固定的逻辑帧</strong>搜集<strong>变化的状态数据</strong>并进行网络同步。</p>
<h3 id="常见案例"><a href="#常见案例" class="headerlink" title="常见案例"></a>常见案例</h3><ul>
<li>ACT类游戏，为及时响应打击感在客户端使用<strong>定点数</strong>，按照<strong>逻辑帧</strong>驱动游戏运行，服务端只同步<strong>玩家输入的指令</strong>(帧同步)</li>
<li>MMORPG，为增加同屏人数，使用<strong>服务端运行全量逻辑</strong>方案，只同步玩家释放技能指令，血量变化，蓝量改变等<strong>状态数据</strong>来优化带宽占用。(状态同步)</li>
<li>MOBA类游戏，为了应对恶劣的网络环境与优化带宽，使用<strong>自定义可靠UDP</strong>方案，<strong>按帧同步数据</strong>，在本地使用<strong>定点数</strong>，<strong>服务器运行全量战斗逻辑</strong>判断玩家是否存在作弊行为。（帧同步）</li>
<li>FPS游戏，本地与服务器同时跑全量战斗逻辑，本地可先行于服务器做预测，并按照逻辑帧来搜集同步每一帧发生变化的状态数据，当客户端发现与服务端状态不一致时进行回滚（状态帧同步）</li>
</ul>
<h3 id="不同同步策略特性"><a href="#不同同步策略特性" class="headerlink" title="不同同步策略特性"></a>不同同步策略特性</h3><ul>
<li>帧同步的特点是有明确的帧逻辑概念，并且按照逻辑帧来同步网络数据。</li>
<li>状态同步的特点是状态发生变化就进行同步</li>
<li>状态帧同步特点是按照逻辑帧对发生了变化的状态数据进行搜集并同步</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2022/03/19/%E5%B8%A7%E5%90%8C%E6%AD%A5%E3%80%81%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E7%8A%B6%E6%80%81%E5%B8%A7%E5%90%8C%E6%AD%A5/" data-id="cm7o74kkg0015esw4bwtw7mfn" data-title="帧同步、状态同步、状态帧同步" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Lua堆栈操作" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/09/Lua%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C/" class="article-date">
  <time class="dt-published" datetime="2022-02-09T15:23:24.000Z" itemprop="datePublished">2022-02-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Lua/">Lua</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/02/09/Lua%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C/">Lua堆栈操作</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Lua和-C交互"><a href="#Lua和-C交互" class="headerlink" title="Lua和 C交互"></a>Lua和 C交互</h3><p>Lua和C的所有交互都是通过了栈。用简单的话来讲就是这个数据结构让Lua可以从栈中取数据和放数据，也可以让C来取数据和放数据。栈中的数据通过索引值进行定位，所有进栈的东西都有一个标号，这个标号就是index。</p>
<p>栈顶为-1，栈底为1（代表第一个入栈的元素）。正数表示相对于栈底的位置(第几位)，负数表示相遇栈顶的位置。</p>
<h3 id="常用的几个C-API"><a href="#常用的几个C-API" class="headerlink" title="常用的几个C-API"></a>常用的几个C-API</h3><ul>
<li><strong>lua_gettop()</strong></li>
</ul>
<p>用于返回栈中元素的个数，同事也是栈顶元素的索引。栈中有多少个元素，就会return几。返回值是栈中元素个数，也同样是栈顶元素的index。</p>
<ul>
<li><p><strong>lua_settop(lua_State L, int index)</strong><br>用于把对战的栈顶索引设置为指定的数值。例如，一个栈有8个元素，调用函数index &#x3D; 7，相当于堆栈的栈顶元素index 由 8 -&gt; 7，操作相当于删除了栈顶元素。使用正数为从栈顶开始计算位置，如果使用负数为从栈底开始计算位置。</p>
</li>
<li><p><strong>lua_pushvalue(lua_State L, int index)</strong><br>函数说明：Push a copy of the element at the given valid index onto the stack</p>
</li>
</ul>
<p>10 20 30 40 50 * -&gt;<br>lua_pushvalue(L, 3) -&gt;<br>10 20 30 40 50 30 *</p>
<ul>
<li><strong>lua_remove(lua_State L, int index)</strong><br>lua_remove 删除指定给定索引的元素，并将这一所引致上的元素来填补空缺,</li>
<li><strong>lua_replace(lua_State L, int index)</strong><br>lua replace将栈顶元素压入指定位置而不移动任何元素(因此指定位置的元素的值被替换)<br>10 20 30 40 50* -&gt; lua_replace(L, 2) -&gt; 10 50 30 40*</li>
</ul>
<h3 id="C加载lua函数的用法"><a href="#C加载lua函数的用法" class="headerlink" title="C加载lua函数的用法"></a>C加载lua函数的用法</h3><ul>
<li><p><strong>lua_getglobal(lua_State L, const char name)</strong><br>将全局name的值压到栈顶</p>
</li>
<li><p><strong>lua_is(lua_State L, int index)</strong><br>检查变量是不是某个类型，index指示变量顺序，栈顶为-1</p>
</li>
<li><p><strong>lua_to(lua_State L, int index)</strong><br>获取栈中的变量， 然后转化为某个指定的类型并且返回</p>
</li>
<li><p><strong>lua_close()</strong><br>销毁所有在指定的Lua State上的所有对象，同时释放所有该State使用的动态分配的空间</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2022/02/09/Lua%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C/" data-id="cm7o74kka000cesw4byk7f9jf" data-title="Lua堆栈操作" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2021-12-18工作总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/25/2021-12-18%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-12-25T10:56:36.000Z" itemprop="datePublished">2021-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%81%8C%E5%9C%BA/">职场</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/25/2021-12-18%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/">2021.12.18工作总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="两个月的工作"><a href="#两个月的工作" class="headerlink" title="两个月的工作"></a>两个月的工作</h1><h2 id="1-个人工作"><a href="#1-个人工作" class="headerlink" title="1.个人工作"></a>1.个人工作</h2><p>作为客户端Unity开发入职公司已经2个月的时间了，项目的规模可以算的上是同种类型中最为完整且面面俱到。相对应的解决方案和开发配套工具也都十分完善，日常开发中的玩法需求机制都足以支撑新的功能。作为新人就是熟悉系统业务模块然后正删改查完成策划提出的需求。</p>
<h3 id="2-工作法"><a href="#2-工作法" class="headerlink" title="2. 工作法"></a>2. 工作法</h3><p>前些天在浏览博客的时候发现了一篇对我很受用的文章觉得可以进行一些感悟的总结。出入职场作为一个程序员面对工作中的需求和学校学习中的编程项目还是会有很大不同的，工作法是我觉得在初期首先要培养好的一个好习惯也好还是一种能力也好，总之是要拥有的。这样才能在大功能和复杂系统的构建当中从容儿稳健的完成。首先一个需求不是仅仅靠程序来进行编码就能够完成的，编码只是实现方法的最后一道工序。从需求的对接，前后端协议的商定到UE、UI的出图，这里面的每一道工序都是实现一个稳定良好功能需求的基础。当需求功能足够大的时候，我在分析的过程中会有很多很多想不到的问题，对于最终的结果很多时候是不可见的，只有当做的时候碰到了问题在临时去协调修改就会影响到需求的进度。对于优化的需求当中，有时候会写和原策略相同，这个地方就会有很多坑。如果你不熟悉 其实就相当于一个新需求，你也要花时间去看逻辑，因为在很多优化和翻新的时候界面View的代码需要修改这样就需要你去熟悉逻辑代码但是不需要重修。所以，做好第一步需求文档的分析很重要！</p>
<h2 id="原文复制部分"><a href="#原文复制部分" class="headerlink" title="原文复制部分"></a>原文复制部分</h2><p>这是我在浏览博客的时候看到的一位来自美团的工程师做的工作总结，我看过之后觉得其中的内容能够同样应用在我的个人的工作当中。链接目前没有找到，所以直接复制了原文进行记录。</p>
<p>来源：美团技术博客</p>
<p><strong>作者</strong>：云鹏，2014年加入美团，先后参与了美团酒店供应链体系、分布式调度系统的建设，现在负责美团旅行客户关系管理系统、基础信息服务的建设工作。</p>
<p><strong>引言</strong><br>时间回到8年前，我人生中的第一份实习工作，是在某互联网公司的无线搜索部做一个C++工程师。当时的我可谓意气风发，想要大干一场，结果第一次上线就写了人生中第一个Casestudy。由于对部署环境的不了解，把SVN库里的配置文件错误地发到线上，并且上完线就去吃晚饭了，等吃饭回来发现师傅在焦头烂额地回滚配置。那次故障造成了一个核心服务20分钟不可用，影响了几百万的用户。</p>
<p>这仅仅是一个开始，在后来半年的时间里，我几乎把所有职场新人可能犯的错误都犯了个遍。架构师让我调研一个抓取性能提升方案，我闷头搞了两周，也没有得出任何结论；本来安排好的开发计划，由于我临时要回去写论文，搞得经理措手不及；参加项目座谈会，全程“打酱油”……那段时间，自己也很苦恼，几乎每天晚上11点多才走，很累很辛苦，但依然拿不到想要的结果。</p>
<p>8年过去了，自己从一个职场小白逐步成长为一名技术Leader。我发现团队中的很多同学在不停地重复犯着自己当年类似的错误。他们并不是不努力，到底是哪里出了问题？经过一段时间的观察与思考后，我想我找到了答案。那就是：我们大多数同学在工作中缺乏原则的指导。原则，犹如指引行动的“灯塔”，它连接着我们的价值观与行动。不久前，桥水基金创始人雷·达里奥在《原则》一书中所传达的理念，引爆了朋友圈。<br><strong>每个人都应该有自己的原则，当我们需要作出选择时，一定要坚持以原则为中心。</strong> 但是在现实生活中，我们往往缺少对原则的总结，对于很多人来说这是一门“只可意会不可言传”的玄学，是属于老司机的秘密，其实不然。“追求卓越”是美团的价值观。作为一名技术人员，我们应该如何践行呢？本文总结了十条精进原则，希望能够给大家带来一些启发，更好地指导我们的行动。</p>
<h1 id="原则一：Owner意识"><a href="#原则一：Owner意识" class="headerlink" title="原则一：Owner意识"></a><strong>原则一：Owner意识</strong></h1><p>“Owner意识”主要体现在两个层面：一是认真负责的态度，二是积极主动的精神。</p>
<p><strong>认真负责是工作的底线。</strong> 首先，要对我们交付的结果负责。项目中每一个设计文档、每一行代码都需要认真完成，要对它的质量负责。如果设计文档逻辑混乱，代码没有注释，测试时发现一堆Bug，影响的不仅仅是RD的工程交付质量，还会对协同工作的RD、QA、PM等产生不好的影响。久而久之，团队的整体交付质量、工作效率也会逐步下降，甚至会导致团队成员之间产生不信任感。其次，我们要对开发的系统负责。系统的架构是否需要改进，接口文档是否完善，日志是否完整，数据库是否需要扩容，缓存空间够不够等等，这些都是需要落地的事情。作为系统Owner，请一定要认真履行。</p>
<p><strong>积极主动是“Owner意识”更高一级的要求。</strong> RD每天要面对大量的工作，而且很多并不在计划内，这就需要具备一种积极主动的精神。例如我们每天可能会面对大量的技术咨询，如果客户提出的问题很长时间得不到回应的话，就会带来不好的客户体验。很多同学说忙于自己的工作没有时间处理，有同学觉得这件事不是很重要，也有很多同学是看到了，但是不知道怎么回答，更有甚者，看到了干脆装没看见。这些都是缺乏Owner意识的体现。正确的做法是积极主动地推动问题的解决，如果时间无法排开或者不知道如何解决，可以直接将问题反馈给能解决的同学。积极主动还可以表现在更多方面。比如很多同学会自发地梳理负责服务的现状，根据接口在性能方面暴露的问题提出改进意见并持续推动解决；也有同学在跨团队沟通中主动承担起主R的角色，积极发现问题、暴露问题，推动合作团队的进度，保证项目顺利推进。这些同学无一不是团队的中坚力量。所以，我们在做好自己份内工作的同时，也应该积极主动地投入到“份外”的工作中去。一分耕耘一分收获，不要给自己设限，努力成为一个更加优秀的人。</p>
<h1 id="原则二：时间观念"><a href="#原则二：时间观念" class="headerlink" title="原则二：时间观念"></a><strong>原则二：时间观念</strong></h1><p>相信大家都有时间观念，但是真正能执行到位的可能并没有那么多。互联网是一个快速发展的行业，RD的研发效率是一个公司硬实力的重要体现。项目的按期交付是一项很重要的执行能力，在很大程度上决定着领导和同事对自己靠谱程度的评价。大家可能会问：难度几乎相同的项目，为什么有的同学经常Delay，而有的同学每次都能按时上线？一个很重要的原因，就是这些按时交付的同学往往具备如下两个特质：<strong>做事有计划，工作分主次。</strong></p>
<p><strong>工作安排要有计划性。</strong> 通常，RD在设计评审之后就能预估出精确的开发时间，进而再合理地安排开发、联调、测试计划。如果是项目负责人，那么就会涉及协调FE、QA、PM等多个工种的同学共同完成工作。凡事预则立，不预则废。在计划制定过程中，要尽可能把每一项拆细一点（至少到pd粒度）。事实证明，粒度越细，计划就越精准，实际开发时间与计划之间的误差就会越小。此外，务必要规定明确的可检查的产出，并在计划中设置一些关键的时间点进行核对。无数血淋淋的事实告诉我们，很多项目延期都是因为在一些关键交付点上双方存在分歧造成的。例如后台RD的接口文档计划在周五提供，FE认为是周五上午，而RD认为是周五下班前提交，无形中会给排期带来了1pd的误差。所以，我们要做到计划粒度足够细，关键时间点要可检查。</p>
<p><strong>工作安排要分清楚主次。</strong> 我们每天要面对很多的事情，要学会分辨这些工作的主次。可以尝试使用“艾森豪威尔法则”（四象限法则），把工作按照重要、紧急程度分成四象限。优先做重要紧急的事情；重要不紧急的事情可以暂缓做，但是要持续推进；紧急不重要的事情可以酌情委托给最合适的人做；不重要不紧急的事情可以考虑不做。很多项目无法按期交付的原因，都是因为执行人分不清主次。比如在开发中需要使用到ES，一些不熟悉ES的同学可能想系统性地学习一下这方面的知识，就会一头扎进ES的汪洋中。最后才发现，原本一天就能完成的工作被严重拖后。实际工作中，我们应当避免这种“本末倒置”的工作方式。在本例中，“系统性地学习ES”是一件重要但不紧急的事情。要学会分辨出这些干扰的工作项，保证重要紧急的事情能够按时交付。</p>
<h1 id="原则三：以终为始"><a href="#原则三：以终为始" class="headerlink" title="原则三：以终为始"></a><strong>原则三：以终为始</strong></h1><p>“以终为始”（Begin With The End In Mind），是史蒂芬·柯维在《高效能人士的七个习惯》中提到的一个习惯。它是以所有事物都经过两次创造的原则（第一次为心智上的创造，第二次为实际的创造）为基础的。直观的表达就是：<strong>先想清楚目标，然后努力实现。</strong> </p>
<p>在工作中，很多RD往往只是埋头走路，很少抬头看天。每次季度总结的时候，罗列了很多项目，付出很多努力。但是具体这些项目取得了哪些收益，对业务有哪些提升，却很难说出来。这就说明在工作中并没有遵守“以终为始”这一原则。此外，很多同学在做需求的过程中，对于目标与收益关注不够，系统上线之后，也没有持续地跟进使用效果。这一点在技术优化项目中体现的尤为明显。</p>
<p>例如在一个接口性能优化的项目中，经过RD的努力优化，系统TP99缩短了60%，支持QPS提升了2倍。但是系统到底需要优化到什么程度呢？是不是缩短60%，提升2倍就能满足需求呢？在优化之前，很多同学常常忘记设置一个预设的目标（TP99小于多少，支持QPS大于多少）。我们必须清楚，优化一定是有原因的，比如预期某节假日流量会暴增或者某接口超时比例过高，如果不进行优化，系统可能会存在宕机风险。解决特定的问题才是技术优化的最终目的，<strong>所以要根据问题设定目标，再进行优化</strong>。</p>
<p>“以终为始”，这一原则还可以作用于我们的学习中。很多同学看过很多技术文章，但是总是感觉自己依然一无所知。很重要的一个原因，就是没有<strong>带着目标去学习</strong>。在这个信息爆炸的时代，如果只是碎片化地接收各个公众号推送的文章，效果几乎可以忽略不计。在学习之前，我们一定要问自己，这次学习的目标是什么？是想把Redis的持久化原理搞清楚，还是把Redis的主从同步机制弄明白，亦或是想学习整个Redis Cluster的架构体系。如果我们能够带着问题与目标，再进行相关的资料搜集与学习，就会事半功倍。这种学习模式的效果会比碎片化阅读好很多。</p>
<h1 id="原则四：闭环思维"><a href="#原则四：闭环思维" class="headerlink" title="原则四：闭环思维"></a><strong>原则四：闭环思维</strong></h1><p>你是否遇到过这样的场景：参加了一个设计（或需求）评审，大家兴致勃勃地提了很多合理的意见，等到再次评审的时候，却发现第一次提的很多问题都没有得到改进，很多讨论过的问题需要从头再开始讨论。这种情况就是一种典型的工作不闭环。之前看过一句话：一个人是否靠谱，就看他能否做到凡事有交代，件件有着落，事事有回音。这就是闭环思维的重要性。<strong>它强调的是一种即时反馈闭环，</strong> 如果别人给我们分配了一个任务，不管完成的结果如何，一定要在规定的时间内给出明确的反馈。例如在跨部门的沟通会议中，虽然各方达成了一致，会议发起者已经将最终的记录周知大家。但是，到这一步其实并没有完成真正的闭环，在落地执行过程中很可能还存在一些潜在的问题。例如，会议纪要是否经各方仔细核对并确认过？会议中明确的To Do进展是什么？完成结果有没有Check的机制？如果这些没有做到的话，就会陷入“沟通-发现问题-再沟通-再发现问题”的恶性循环中。<strong>真正的闭环，要求我们对工作中的事情都能够养成良好的思维习惯，沟通要有结论，通知要有反馈，To Do要有验收。</strong></p>
<p><strong>“闭环思维”还要求能够定期主动进行阶段性的反馈。</strong> 刚参加工作时，我接了一个工期为两个月的项目。整个项目需要独自完成，自己每天按照计划，有条不紊地进行开发。大概过了两周之后，Leader询问项目进度，虽然我已经跟他说没问题。然而，Leader告诉我，因为我每天对着电脑也不说话，让他心里很没底。这时，我才意识到一个很重要的问题，我跟Leader之间存在信息不对称。从那以后，我就时不时得跟他汇报一下进度，哪怕就只有简短的一句话，也可以明显感觉，他对我的信心增加了很多。特别是我做Leader之后，对这种闭环反馈的理解，就更加深刻了。从Leader的角度看，其实只是想知道项目是否在正常推进，是否遇到问题需要他协助解决。</p>
<h1 id="原则五：保持敬畏"><a href="#原则五：保持敬畏" class="headerlink" title="原则五：保持敬畏"></a><strong>原则五：保持敬畏</strong></h1><p>“君子之心，常怀敬畏”，保持敬畏之心能够让我们少犯错误。在工作中存在各种各样的规范，例如代码规范、设计规范、上线规范等等。我们必须明白，这些规范的制定一定是基于某些客观原因的，它们都是历史上无数Case积累而来的经验。团队里的每一个成员都应该学习并严格遵守，这一点对于新人尤其重要。<strong>当我们进入到一个新的团队，请先暂时忘掉之前的习惯，要尽快学习团队既有的规范，并且让自己与团队保持一致。</strong> 以编码风格为例，很多同学往往习惯于自己之前的代码写作风格，在做新公司第一个项目时，也按照自己的习惯进行变量、包的命名等等。结果在代码Review过程中，被提了很多修改意见，不得不返工重写，得不偿失。如果能够保持敬畏之心，提前了解编码规范，这种问题完全可以避免。类似的问题，还包括对上线流程的不了解，对回滚操作不熟悉，对SRE线上变更过程不了解等等。除了这些显而易见的规范，还有一些约定俗成的规则。个人建议是：如果有事情拿不准，不妨多问问其他同事，不要凭自己的感觉做事情。保持敬畏之心并不意味着要“因循守旧”。在我们充分了解这些规范和约定之后，如果觉得存在不妥之处，可以跟全组同学讨论，是否采纳新的建议，然后及时去更新迭代。其实，<strong>让规范与约定与时俱进，也是另一种形式的敬畏。</strong></p>
<h1 id="原则六：事不过二"><a href="#原则六：事不过二" class="headerlink" title="原则六：事不过二"></a><strong>原则六：事不过二</strong></h1><p>“事不过二”，是我们团队一贯坚持的原则，它可以解读为两层含义。一层含义是 <strong>“所有的评审与问题讨论，不要超过两次”</strong> 。之所以有这样的要求，是因为我们发现，很多RD都把时间花费在一些无休止的评审与问题讨论中，真正投入到实际开发中的时间反而很少。在实际工作场景中，我们经常会遇到一些不是很成熟的需求评审。这些需求文档，要么是背景与目标含糊不清，要么是产品方案描述不够细化，或者存在歧义。RD与PM被迫反复进行讨论，我曾经遇到过一个需求评审，进行了三次还被打回。同样的问题，在设计评审中也屡见不鲜。方案固然需要经过反复的讨论，但是如果迟迟不能达成一致，就会耗费很多RD与PM的宝贵时间，这就与提升研发效率的理念背道而驰。因此我们团队规定：<strong>所有的评审最多两次。</strong> 通过这种方式，倒逼利益相关方尽可能地做好需求与方案设计。评审会议组织前，尝试与所有相关人员达成一致，询问对方的意见，并进行有针对性的讨论，这样能够大大提升评审会议的效率和质量。如果在第一次评审中不通过，那么就只有一次机会进行复审。一旦两次不通过，就需要进行Casestudy。“事不过二”原则的另一层含义，是 <strong>“同样的错误不能犯第二次”</strong> 。每次故障之后，Casestudy都必须进行深刻的总结复盘，对故障原因进行5Why分析，给出明确可执行的To Do List。每次季度总结会，大家自我反省问题所在，在下个季度必须有所改善，不能再犯类似的错误。孔子云：“不迁怒，不贰过”，在错误中反思与成长，才能让我们成为更优秀的人。</p>
<h1 id="原则七：设计优先"><a href="#原则七：设计优先" class="headerlink" title="原则七：设计优先"></a><strong>原则七：设计优先</strong></h1><p>“设计优先”这条原则，相对来说更加具体一些。之所以单列一项，是因为架构设计太重要了。Uncle Bob曾说过：“软件架构的目标，是为了让构建与维护系统的所需人力资源最小化。”<strong>架构设计，并不仅仅关系到系统的质量，还关乎团队的效能问题。</strong> 很多团队也有明文规定，开发周期在3pd以上的项目必须有设计文档，开发周期在5pd以上的项目必须有设计评审。在具体的执行过程中，由于各种原因，设计往往并不能达到预期的效果。究其原因，有的是因为项目周期紧，来不及设计的足够详细；有的是因为RD主观上认为项目比较简单，设计草草了事。<strong>无数事实证明，忽略了前期设计，往往会导致后续开发周期被大幅拉长，给项目带来了很大的Delay风险。而且最可怕的是，不当的设计会给项目带来巨大的后期维护成本，我们不得不腾出时间，专门进行项目的优化与重构。</strong> 因此，无论什么时候都要记住“设计优先”这一原则。磨刀不误砍柴工，前期良好的设计，会给项目开发以及后期维护带来极大的收益。 <strong>“设计优先”这一原则，要求写别人看得懂的设计</strong>。我们了解一个系统最直接的途径就是结合设计文档与代码。在实际工作中，很多同学的设计文档让大家看得一头雾水，通篇下来，看不出系统整体的设计思路。其实，设计的过程是一种智力上的创造，我们更希望它能成为个人与集体智慧的结晶。如何才能让我们的设计变得通俗易懂？我个人认为，设计应该尽量使用比较合理的逻辑，进而把设计中的一些点组织起来。比如可以使用从抽象到具体，由总到分的结构来组织材料。在设计过程中，要以需求为出发点，通过合理的抽象把问题简化，讲清楚各个模块之间的关系，再详细分述模块的实现细节。做完设计之后，可以发给比较资深的RD或者PM审阅一下，根据他们的反馈再进行完善。好的设计，一定是逻辑清晰易懂、细节落地可执行的。</p>
<h1 id="原则八：P-PC平衡"><a href="#原则八：P-PC平衡" class="headerlink" title="原则八：P&#x2F;PC平衡"></a><strong>原则八：P&#x2F;PC平衡</strong></h1><p>“P&#x2F;PC平衡”原则，即产出与产能平衡原则。伊索寓言中讲述了一个《生金蛋的鹅》的故事。产出好比“金蛋”，产能好比“会下金蛋的鹅”。“重蛋轻鹅”的人，最终可能连产蛋的资产都保不住；“重鹅轻蛋”的人，最终可能会被饿死。<strong>产出与产能必须平衡，才能达到真正的高效能</strong>。为了让大家更清晰的了解这一原则，本文举两个例子。</p>
<p>从系统的角度看，每一个系统都是通过持续不断地叠加功能，来实现其产出，而系统的产能是通过系统架构的可扩展性、稳定性等一系列特性来表征。为了达到产出与产能的平衡，需要在不断支持业务需求的过程中，持续进行技术架构层面的优化。如果一味地做业务需求，经过一定的时间，系统会越来越慢，最终影响业务的稳定性；反之，一个没有任何业务产出的系统，最终会消亡。</p>
<p>再从RD的角度来看这个问题，RD通过做需求来给公司创造价值，实现自己的产出。而RD的产能是指技术能力、软素质、身体健康状况，有这些资本后，我们才能进行持续的产出。在日常工作中，我发现很多RD往往只重视产出。他们也在很努力地做项目，但是每一个项目所使用的方法，还是沿用自己先前一贯的思路。最终，不仅项目做得一般，还会抱怨自己得不到任何成长。这就是P&#x2F;PC不平衡的体现。<strong>如果能在做项目的过程中，通过学习和总结持续提升自己的技术能力和软素质，并将其应用于项目实施交付中，相信一定会取得双赢的结果。</strong> “P&#x2F;PC平衡”原则还适用于很多其他的领域，例如团队、家庭等，我本人也非常推崇这一原则。希望大家也能将其作为自身的一项基本原则，努力寻找到产出与产能的平衡点。</p>
<h1 id="原则九：善于提问"><a href="#原则九：善于提问" class="headerlink" title="原则九：善于提问"></a><strong>原则九：善于提问</strong></h1><p><strong>“善于提问”，首先要勤于提问</strong>。求知欲源于好奇心，是人类的一种本能。在工作中要养成勤于提问的好习惯，不懂就问，不要因为自己一时懒惰或者碍于情面，就放弃提问的机会。当遇到不同的观点时，也要礼貌地问出来。波克定理告诉我们，<strong>只有在争辩中，才可能诞生最好的主意和最好的决定</strong>。在设计评审、代码评审这类体现集体智慧的活动中，遇到有问题的地方一定要提出来。我经常看到，很多同学评审全程一言不发，这就是浪费大家的时间。设计评审的目的，是让大家针对方案提出改进意见并达成一致，如果全程“打酱油”，那就失去了评审的意义。我们鼓励大家多提问，把自己内心的疑惑表达出来，然后通过交流的方式得到答案。 </p>
<p><strong>“善于提问”，还要懂得如何提问</strong>。为什么同样是参加设计评审，有的同学就能提出很好的问题，而有的同学却提不出任何问题？除了知识储备、专业技能、经验等方面的差异外，还有一点很重要：这就是批判性思维。批判性思维主张通过批判性思考达到理性思维，即对事物本质的认知和掌握。关于如何进行批判性思维，大家可以参考一些经典的图书如《批判性思维》、《学会提问》等。在工作中面临一项决策时，会有各种各样的意见摆在你面前，所以我们必须要学会使用批判性思维来进行分析，每个人的论据是否可靠，论证是否合理，是否有隐含的立场。同样，在阅读一篇技术博客的时候，也要使用批判性的思维，多问几个为什么，作者得出的结论是否合理？论据是否充分？只有这样，才能不断地获取真正的知识。</p>
<h1 id="原则十：空杯心态"><a href="#原则十：空杯心态" class="headerlink" title="原则十：空杯心态"></a><strong>原则十：空杯心态</strong></h1><p>“满招损，谦受益”，“空杯心态”是最后一项原则。我觉得这也是一个人能够持续成长的前提。做技术的人，骨子里通常有股傲气，并且会随着资历、成绩的提升而不断增加。初入职场的小白，可能会非常谦虚，但是工作几年之后，专业技能逐步提升，可能还取得了一些小成就，人就会越来越自信。这时候，如果不能始终保持“空杯心态”，这种自信就会逐步演变为自满。自满的人，往往表现为工作中把别人的建议当成是批评，不接受任何反对意见，学习上也缺乏求知的动力，总是拿自己的长处去跟别人的短处做比较。其实每个人多少都会有一些自满，可怕的是不知道甚至不愿承认自满。<strong>保持“空杯心态”这一原则要求我们时刻进行自我检视与反省</strong>。在工作中，多去跟不同级别的同学聊一聊，或者做一个360度评估，这有助于我们更加客观地评价自己。在横向对比中，多向那些优秀的同学看齐，学习他人的优点。很多同学在设计评审或者代码Review过程中，针对别人提出的问题与建议，往往都采用一种对立的态度。错误地认为别人是在挑刺，是在针对自己。诚然，在某些方面，我们可能确实比其他人想得深入，但是这不代表在所有方面都能考虑周全。对于别人的建议，建议使用“善于提问”原则里提到的批判性思维仔细分析一下，虚心地吸取那些好的建议。工作学习就像“练级打怪”，技能储备的越多，就越容易走到最后。保持空杯心态，可以让我们发现很多以前注意不到的新能力，我们要做的就是努力学习它，将它们转化为自己能力库的一部分。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h1><p>以上，是我总结的工作与学习的十条基本原则。其中有的侧重于个人做事情的方法，如“Owner意识”、“时间观念”、“以终为始”、”闭环思维”；有的侧重于团队工作标准规范，如“保持敬畏”、“事不过二”、“设计优先”；有的侧重于团队或个人效能提升，如“P&#x2F;PC平衡”、“善于提问”、“空杯心态”。这些原则是我多年在工作与学习中，不断总结得来的经验。希望在大家面临选择时，这些原则能够起到一定的帮助和指导作用。以原则为中心地工作与生活，让自己与团队变得更加强大。</p>
<h2 id="个人"><a href="#个人" class="headerlink" title="个人"></a>个人</h2><p>经过了几个需求的开发过程中，我也想聊聊了一些除开技术相关的一些能力和问题，一个需求能不能很好的完成有时候不是因为代码写的好不好。当我面对一些需求的时候，首先第一沟通对象就是策划。有的时候我所做的不单单是一个新功能，而是对功能的修改和优化。<br>第二个月乃至半年之内需要提升有两个事情。</p>
<ol>
<li>提升对项目周期估期的能力，学习并且形成自己的工作法能够提前分析需求中的所有技术难点。项目周期预估这件事对我来说是最难的目前。</li>
<li>给自己顶一个2022年的计划，学习XLUA、业余时间完成一个自己的游戏</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://guanyy95.github.io/2021/12/25/2021-12-18%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/" data-id="cm7o74kka0009esw47v9qf4kn" data-title="2021.12.18工作总结" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Lua/">Lua</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Testing/">Testing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%B7%E9%A2%98/">刷题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/C/">C#</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E5%9C%BA/">职场</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/02/28/Unity%E4%BC%98%E5%8C%96%E7%AF%87-Texture%E7%BA%B9%E7%90%86/">Unity优化篇-Texture纹理</a>
          </li>
        
          <li>
            <a href="/2024/10/23/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2023/07/22/%E3%80%90%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E3%80%91UGUI%E5%90%88%E6%89%B9%E9%97%AE%E9%A2%98/">【游戏开发】UGUI合批问题</a>
          </li>
        
          <li>
            <a href="/2023/01/25/%E6%A0%B9%E6%8D%AE%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90pdf%E5%90%88%E5%90%8C%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">根据模板生成pdf合同脚本使用说明</a>
          </li>
        
          <li>
            <a href="/2022/12/10/Lua%E5%A5%87%E6%B7%AB%E5%B0%8F%E6%8A%80%E5%B7%A7/">Lua奇淫小技巧</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 GYY<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>